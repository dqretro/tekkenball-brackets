<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pools</title>
<link rel="stylesheet" href="../../styles.css">
<link rel="stylesheet" href="../../shared/layout/header/nav/nav.css">
<style>
#relatedEvents a.active-event{ font-weight:bold; color:gold; }
#relatedEvents a{ display:block; margin-bottom:6px; }
.pool{ border:1px solid #444; border-radius:6px; padding:10px; margin-bottom:15px; }
.pool h3{ margin-bottom:8px; }
.entrant{ display:flex; justify-content:space-between; padding:4px 0; border-bottom:1px dashed #333; }
.entrant:last-child{ border-bottom:none; }
</style>
</head>
<body class="dark">

<div id="nav-t-placeholder"></div>
<script src="/shared/layout/header/nav/nav_t.js" defer></script>

<div class="container">
  <div class="overview-header">
    <div class="overview-title">
      <h1>Event Brackets</h1>
      <h2 id="standings-title"></h2>
    </div>
    <div id="back-to-events" class="back-button"></div>
  </div>

  <section class="summary">
    <h2>Summary</h2>
    <p>
      <strong id="entrant-count">0 Entrants</strong>,
      <span id="pool-count">0 Pools</span> →
      <span id="topcut-size-text">Top 0</span>, Double Elimination
    </p>
  </section>

  <header class="event-header">
    <h2 id="event-name">Event</h2>
    <p id="event-date"></p>
    <p id="event-game"></p>
    <p id="event-entrants"></p>
  </header>

  <section id="relatedEvents"></section>
  <section id="poolsContainer"></section>
</div>

<div id="footer-placeholder"></div>

<script src="../../script.js"></script>
<script src="events.js"></script>

<script>
loadNav(); loadFooter();
const urlSlug = new URLSearchParams(window.location.search).get("slug");
if(urlSlug) initPoolsPage(urlSlug);

async function initPoolsPage(slug){
  if(!slug) return;
  updateEventHeader(slug);

  const tournament = await fetchTournament(slug);
  const event = tournament?.events?.find(ev=>ev.slug===slug);
  if(!event) return;

  document.getElementById("event-name").textContent = event.name;
  document.getElementById("event-date").textContent = `Date: ${event.startAt?new Date(event.startAt).toLocaleDateString():"TBA"}`;
  document.getElementById("event-game").textContent = `Game: ${event.game||"Unknown"}`;
  document.getElementById("event-entrants").textContent = `Entrants: ${event.entrants?.nodes?.length||0}`;

  const poolsContainer = document.getElementById("poolsContainer"); poolsContainer.innerHTML="";
  let pools = event.pools||[];
  if(!pools.length){ const entrants = event.entrants?.nodes||[]; let poolIndex=1; for(let i=0;i<entrants.length;i+=4) pools.push({name:`Pool ${poolIndex++}`,entrants:entrants.slice(i,i+4)}); }
  pools.forEach(pool=>{
    const div=document.createElement("div"); div.className="pool"; div.innerHTML=`<h3>${pool.name}</h3>`;
    (pool.entrants||[]).forEach(ent=>{
      const stats=ent.standing?.stats;
      const row=document.createElement("div"); row.className="entrant";
      row.innerHTML=`<span>${ent.name||"Unknown Entrant"}</span><span>${stats?`${stats.wins.value}-${stats.losses.value}`:""}</span>`;
      div.appendChild(row);
    });
    poolsContainer.appendChild(div);
  });

  document.getElementById("back-to-events").innerHTML=`<a href="${withBase(`/pages/tournaments/events.html?slug=${encodeURIComponent(slug)}`)}" class="button secondary">← Back to Event</a>`;
}
</script>
</body>
</html>

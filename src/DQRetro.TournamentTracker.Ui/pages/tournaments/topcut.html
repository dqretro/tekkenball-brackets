<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Top Cut Bracket</title>
<link rel="stylesheet" href="../../styles.css">
<style>
  body.dark { background: #111; color: #eee; }
  .container { max-width: 900px; margin: 0 auto; padding: 16px; }
  h1 { margin-bottom: 16px; }
  .back-button { margin-bottom: 16px; display: inline-block; cursor: pointer; color: var(--highlight); }
</style>
</head>


<body class="dark">

<div class="container">
  <div class="back-button" id="back-button">&larr; Back to Brackets</div>
  <h1 id="topcut-title"></h1>
  <div id="topcutContainer" class="bracket-container"></div>
</div>

<script src="../../script.js"></script>
<script src="brackets.js"></script>
<script>
  document.getElementById("back-button").addEventListener("click", () => window.history.back());

  (async () => {
    const slug = new URLSearchParams(window.location.search).get("slug");
    if (!slug) return alert("No event specified.");

    const tournament = await fetchTournament(slug);
    const event = tournament.events.find(ev => ev.slug === slug);
    if (!event || !event.topcut) return alert("No top cut available.");

    document.getElementById("topcut-title").textContent = `${event.tournamentName} - ${event.name} Top Cut`;

    const players = event.topcut.players || [];
    const matches = event.topcut.sets?.length ? event.topcut.sets.map(s => ({ player1:s.winner, player2:s.loser, winner:s.winner, score:s.score })) : generateDummySets(players);
    const matchesWithRounds = assignRounds(matches, players.length);

    new BracketsViewer(document.getElementById("topcutContainer"), {
      teams: players,
      matches: matchesWithRounds
    }, { doubleElimination: true });
  })();
</script>

</body>
</html>
